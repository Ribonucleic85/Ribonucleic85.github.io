<html>
<head>
	<title>DBZ</title>
	<link rel="stylesheet" href="./css/dbz.css">
	<script src="./js/dbz1.js"></script>
</head>
<body>
	<textarea class="encoded" id="ifrEncSrc" onfocus="autoselect(this)"></textarea>
	<input type="text" class="numero" id="ifrDecNum">
	<input type="button" value="number" onclick="getNumber(byId('ifrEncSrc'), byId('ifrDecNum'))">
	<input type="button" value="strip" onclick="stripSource(byId('ifrEncSrc'))">
	<input type="button" value="decode" onclick="byId('ifrDcdSrc').value = decoder(byId('ifrEncSrc'), byId('ifrDecNum'))">
	<input type="button" value="get" onclick="getURL(byId('ifrDcdSrc'))">
	<br>
	<input type="button" value="link page"
		onclick="addLink(byId('links'), byId('baselink').value, byId('ifrDcdSrc').value, epNo(byId('epno')))">
	<input type="button" value="link vid"
		onclick="addLink(byId('links'), byId('baselink').value, '', byId('epno').value-1, '\x64\x62\x7A\x20\x65\x70')">
	<br>
	<input type="text" id="epno">
	<input type="text" id="baselink">
	<textarea id="ifrDcdSrc" class="decoded"></textarea>
	<div id="links" onmouseover="autoscroll(this)"></div>
	<textarea class="code">function byId(x) { return document.getElementById(x); }

function decoder(enc, num) {
  var dcd = "";
  num = parseInt(num.value);
  enc = makeArray(enc);
  enc.forEach(
    function _(value) {
      dcd += String.fromCharCode(
      parseInt(atob(value).replace(/\D/g,''))-num);
    }
  );
  return decodeURIComponent(escape(dcd));
}

function stripSource(str) {
  s = str.value;
  s = s.substring(s.indexOf('[')+1, s.indexOf(']'));
  s = s.replace(/\"/g, "");
  s = s.replace(/ /g, "");
  s = s.replace(/\n/g, "");
  s = s.replace(/\[/g, "");
  s = s.replace(/]/g, "");
  s = s.replace(/;/g, "");
  str.value = s;
}

function makeArray(str) {
  var s = str.value;
  return s.split(",");
}

function getURL(e) {
  var s = e.value;
  e.value = s.substring(
    s.indexOf("/", 0),
    s.indexOf("\"", s.indexOf("/",0)+1)
  );
}

function getNumber(s,d) {
  s = s.value.match(/\d+/g);
  d.value = s[s.length-1];
}

function epNo(n) {
  var no = parseInt(n.value);
  n.value = no+1;
  return no;
}

function uS(u) {
  if (u == undefined) return "";
  if (typeof u == "object") return u.value;
  return u;
}

function u(u) {
  return u==undefined;
}

function addLink(el,bl,sp,ei,dl) {
  var link = document.createElement('a');

  link.href = prompt("Address for link", uS(bl) + uS(sp));
  link.innerText = prompt("Episode info", uS(ei));

  if (!u(dl))
    link.setAttribute("\x64\x6F\x77\x6E\x6C\x6F\x61\x64",
    en[parseInt(uS(ei))] );
	//dl +" "+ uS(ei));

  el.appendChild(link);
}

// inline version:
//   onfocus="(function(t){t.select();return false})(this)"
function autoselect(t) {
  t.select();
  return false;
}
    
// incremental inline version
//   onmouseover="this.scrollBy(0,40)"
function autoscroll(t) {
  t.scrollBy(0,40);
}</textarea>

</body>
</html>
