<html><head><title>Textarea selection tester</title><style>
[type=text] {
  width:60px;
}
textarea {
  width: 472px;
  height: 247px;
  resize: none;
}
</style><script>
  
  
  
  
  

const byId = (i) => {
  return document.getElementById(i);
}

const ta = {
  s: 0,
  e: 0,
  set sel(n) {
    n.focus();
    n.selectionStart=this.s
    n.selectionEnd=this.e;
  }
}

const findLineBreaks = (src) => {
  var A = [],
  i = 0,
  s = 0,
  a = 0;
  while (i!=-1) {
    i = src.indexOf("\n", s);
    if (i!=-1)
      A[a] = i,
      s = i+1,
      a++;
  }
  return A;
}

const selectLine = (src,lnNo) => {
  if (lnNo==0)
    return ck(0);
  const lnBr = findLineBreaks(src.value);
  if (lnNo>lnBr.length+1)
    return ck(1);
  const srcLen = src.value.length;
  ck(src+6);
  if (lnBr.length==0)
    ta.s = 0,
    ta.e = srcLen,
    ck(2);
  else if (lnNo==1)
    ta.s = 0,
    ta.e = lnBr[0],
    ck(3);
  else if (lnNo==lnBr.length+1)
    ta.s = lnBr[lnBr.length-1]+1,
    ta.e = srcLen,
    ck(4);
  else
    ta.s = lnBr[lnNo-2]+1,
    ta.e = lnBr[lnNo-1],
    ck(5);
  ta.sel = src;
}

const selectedRange = (ta, st, en) => {
  st.value = ta.selectionStart;
  en.value = ta.selectionEnd;
}

const doSelect = (src, st, en) => {
  ta.s = st.value;
  ta.e = en.value;
  ta.sel = src;
}

/* https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/setSelectionRange
*   Setting inputTextarea.selectionStart and inputTextarea.selectionEnd manually
*   didn't work to well so in future i will try inputTextarea.setSelectionRange()
*/


/* left empty because it is a function i am going to rewrite on the live page,
 it is only in the source to avoid errors and because i defined the function
 i am testing as a constant which cannot be permanently overwritten */
function ck(){}
                







</script></head>
<body><textarea id="selectTest">var thiS = {
  gusto: 'x',
  musto: 'y',
  endo:  'z'
}

function that(a,b,c) {
  if (a) return 1;
  if (b) return "banana";
  if (c) return "error";

  return "defghijklmnopqrstuvw....";
}

var Are = ["you", "trying", "to",
    "make", "sense", "of", "this"]; // ?

var Well = "you can't because while it is valid \
    javascript it has no purpose other than being a \
    block of text to test selecting text in this \
    textarea";</textarea><br><br>Put
selection start and end positions into the fields below and click select..<br>
<input type="text" id="selectStart"> -
<input type="text" id="selectEnd">
<input type="button" value="select" onclick="doSelect(byId('selectTest'),byId('selectStart'),byId('selectEnd'))"><br>
___________________________________________________________<br><br>
To get the start and end selection positions from the textarea click "get",<br>
if both numbers match then it is simply the position of the caret (text cursor).<br>
<input type="text" id="selectedStart"> -
<input type="text" id="selectedEnd">
<input type="button" id="selectedGet" value="get" onclick="selectedRange(byId('selectTest'),byId('selectedStart'),byId('selectedEnd'))"><br>
___________________________________________________________<br><br>
<input type="text" id="selectLine">
<input type="button" value="select line" onclick="selectLine(byId('selectTest'),byId('selectLine').value)">
</body></html>
